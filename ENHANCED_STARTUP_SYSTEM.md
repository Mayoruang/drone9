# ğŸš€ å¢å¼ºç‰ˆæ™ºèƒ½å¯åŠ¨ç³»ç»Ÿ

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†æ”¹è¿›åçš„æ— äººæœºç®¡ç†ç³»ç»Ÿæ™ºèƒ½å¯åŠ¨å™¨ï¼Œç°å·²å®Œå…¨æ”¯æŒDockeræœåŠ¡ç®¡ç†å’Œç½‘ç»œè‡ªé€‚åº”é…ç½®ã€‚

## ğŸ“‹ ç³»ç»Ÿæ¦‚è§ˆ

### å®Œæ•´æ¶æ„
```
ğŸŒ æ— äººæœºç®¡ç†ç³»ç»Ÿ
â”œâ”€â”€ ğŸ³ DockeråŸºç¡€æœåŠ¡å±‚
â”‚   â”œâ”€â”€ PostgreSQL (ç«¯å£ 5432) - ä¸»æ•°æ®åº“
â”‚   â”œâ”€â”€ InfluxDB (ç«¯å£ 8086) - æ—¶åºæ•°æ®åº“
â”‚   â””â”€â”€ EMQX (ç«¯å£ 1883/18083) - MQTTæ¶ˆæ¯ä»£ç†
â”œâ”€â”€ ğŸš€ åº”ç”¨æœåŠ¡å±‚
â”‚   â”œâ”€â”€ Spring Boot åç«¯ (ç«¯å£ 8080)
â”‚   â””â”€â”€ Vue.js å‰ç«¯ (ç«¯å£ 5666)
â””â”€â”€ âš™ï¸ ç®¡ç†è„šæœ¬å±‚
    â”œâ”€â”€ å¯åŠ¨ç®¡ç†
    â”œâ”€â”€ çŠ¶æ€ç›‘æ§
    â””â”€â”€ ç½‘ç»œé…ç½®
```

## ğŸ”§ æ ¸å¿ƒæ”¹è¿›

### 1. **DockeræœåŠ¡é›†æˆ** ğŸ³
- âœ… è‡ªåŠ¨æ£€æµ‹å’Œå¯åŠ¨DockeråŸºç¡€æœåŠ¡
- âœ… å¥åº·çŠ¶æ€ç›‘æ§
- âœ… ç«¯å£æ˜ å°„ç®¡ç†
- âœ… æœåŠ¡ä¾èµ–æ£€æŸ¥

### 2. **è¶…æ—¶ä¿æŠ¤æœºåˆ¶** â±ï¸
- âœ… ç½‘ç»œé…ç½®æ›´æ–°è¶…æ—¶ä¿æŠ¤ (30ç§’)
- âœ… æœåŠ¡å¯åŠ¨è¶…æ—¶ä¿æŠ¤ (åç«¯60ç§’ï¼Œå‰ç«¯60ç§’)
- âœ… æ™ºèƒ½fallbackæœºåˆ¶

### 3. **å…¨é¢çŠ¶æ€ç›‘æ§** ğŸ“Š
- âœ… DockeræœåŠ¡çŠ¶æ€æ£€æŸ¥
- âœ… æ•°æ®åº“è¿æ¥æµ‹è¯•
- âœ… MQTTè¿æ¥éªŒè¯
- âœ… åº”ç”¨å¥åº·æ£€æŸ¥

## ğŸš€ å¯åŠ¨æµç¨‹è¯¦è§£

### Phase 1: ç¯å¢ƒæ£€æŸ¥ ğŸ”
```bash
ğŸš€ æ— äººæœºç®¡ç†ç³»ç»Ÿæ™ºèƒ½å¯åŠ¨å™¨
=============================
[INFO] æ£€æŸ¥ç³»ç»Ÿä¾èµ–...
```

**æ£€æŸ¥é¡¹ç›®**ï¼š
- Docker & Docker Compose
- Java ç¯å¢ƒ
- Node.js & pnpm
- curl å·¥å…·

**éªŒè¯æ–‡ä»¶**ï¼š
- `docker-compose.yml`
- `backend/mvnw`
- `vue-vben-admin/package.json`
- `backend/src/main/resources/application-external.yml`
- `update-network-config.sh`

### Phase 2: DockeræœåŠ¡ç®¡ç† ğŸ³
```bash
[INFO] æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€...
[INFO] å¯åŠ¨DockeråŸºç¡€æœåŠ¡...
```

**æœåŠ¡å¯åŠ¨é¡ºåº**ï¼š
1. **PostgreSQL** - ä¸»æ•°æ®åº“æœåŠ¡
2. **InfluxDB** - æ—¶åºæ•°æ®å­˜å‚¨
3. **EMQX** - MQTTæ¶ˆæ¯ä»£ç†

**ç«¯å£æš´éœ²**ï¼š
- PostgreSQL: `5432`
- InfluxDB: `8086` (ç®¡ç†ç•Œé¢)
- EMQX MQTT: `1883` (åè®®ç«¯å£)
- EMQX Dashboard: `18083` (ç®¡ç†ç•Œé¢ï¼Œadmin/public)

### Phase 3: ç½‘ç»œé…ç½® ğŸŒ
```bash
[SYSTEM] æ›´æ–°ç½‘ç»œé…ç½®...
[INFO] æ›´æ–°ç½‘ç»œé…ç½®...
```

**æ™ºèƒ½IPæ£€æµ‹**ï¼š
- è·¯ç”±è¡¨åˆ†æ
- å¤–éƒ¨æœåŠ¡æŸ¥è¯¢
- ç½‘ç»œæ¥å£æ‰«æ
- æ´»è·ƒè¿æ¥åˆ†æ

**é…ç½®æ›´æ–°**ï¼š
- åç«¯CORSè®¾ç½®
- å‰ç«¯APIåœ°å€
- WebSocketè¿æ¥åœ°å€

**è¶…æ—¶ä¿æŠ¤**ï¼š
- 30ç§’è¶…æ—¶é™åˆ¶
- Fallbackåˆ°localhost

### Phase 4: åº”ç”¨å¯åŠ¨ ğŸš€
```bash
[SYSTEM] å¯åŠ¨ç³»ç»ŸæœåŠ¡...
[INFO] å¯åŠ¨åç«¯æœåŠ¡...
[INFO] å¯åŠ¨å‰ç«¯æœåŠ¡...
```

**åç«¯å¯åŠ¨**ï¼š
```bash
cd backend
nohup ./mvnw spring-boot:run -Dspring-boot.run.profiles=external > ../backend.log 2>&1 &
```

**å‰ç«¯å¯åŠ¨**ï¼š
```bash
cd vue-vben-admin/apps/web-antd
nohup pnpm dev > ../../../frontend.log 2>&1 &
```

**å¥åº·æ£€æŸ¥**ï¼š
- åç«¯ï¼š`/api/status` æ¥å£
- å‰ç«¯ï¼šHTTPå“åº”æµ‹è¯•

### Phase 5: ç®¡ç†è„šæœ¬åˆ›å»º ğŸ“
è‡ªåŠ¨åˆ›å»ºç®¡ç†è„šæœ¬ï¼š
- `stop-system.sh` - ç³»ç»Ÿåœæ­¢
- `restart-system.sh` - ç³»ç»Ÿé‡å¯
- `check-status.sh` - çŠ¶æ€æ£€æŸ¥

## ğŸ› ï¸ ç®¡ç†è„šæœ¬è¯¦è§£

### `start-system.sh` - æ™ºèƒ½å¯åŠ¨å™¨
```bash
./start-system.sh
```
**åŠŸèƒ½**ï¼šå®Œæ•´çš„ç³»ç»Ÿå¯åŠ¨æµç¨‹
**ç‰¹æ€§**ï¼š
- ç¯å¢ƒæ£€æŸ¥å’Œä¾èµ–éªŒè¯
- DockeræœåŠ¡è‡ªåŠ¨ç®¡ç†
- ç½‘ç»œé…ç½®è‡ªåŠ¨æ›´æ–°
- åº”ç”¨æœåŠ¡å¯åŠ¨å’Œå¥åº·æ£€æŸ¥

### `stop-system.sh` - æ™ºèƒ½åœæ­¢å™¨
```bash
# äº¤äº’å¼åœæ­¢
./stop-system.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…å«Dockerï¼‰
./stop-system.sh --docker

# ä»…åœæ­¢åº”ç”¨æœåŠ¡
./stop-system.sh --app-only
```

### `check-status.sh` - å…¨é¢çŠ¶æ€æ£€æŸ¥
```bash
./check-status.sh
```
**æ£€æŸ¥å†…å®¹**ï¼š
- ğŸ³ DockeræœåŠ¡çŠ¶æ€
- ğŸš€ åº”ç”¨æœåŠ¡çŠ¶æ€
- ğŸ’¾ æ•°æ®åº“è¿æ¥çŠ¶æ€
- âš™ï¸ è¿è¡Œè¿›ç¨‹ä¿¡æ¯
- ğŸ”Œ ç«¯å£å ç”¨æƒ…å†µ

### `update-network-config.sh` - ç½‘ç»œé…ç½®ç®¡ç†
```bash
# æ£€æµ‹å¹¶æ›´æ–°é…ç½®
./update-network-config.sh

# å¼ºåˆ¶æ›´æ–°
./update-network-config.sh --force

# è‡ªåŠ¨æ¨¡å¼ï¼ˆæ— éœ€ç¡®è®¤ï¼‰
./update-network-config.sh --auto
```

## ğŸŒ æœåŠ¡è®¿é—®ä¿¡æ¯

### æ ¸å¿ƒæœåŠ¡
| æœåŠ¡ | ç«¯å£ | è®¿é—®åœ°å€ | è¯´æ˜ |
|------|------|----------|------|
| å‰ç«¯ç•Œé¢ | 5666 | http://IP:5666 | ä¸»åº”ç”¨ç•Œé¢ |
| åç«¯API | 8080 | http://IP:8080 | REST APIæœåŠ¡ |
| APIæ–‡æ¡£ | 8080 | http://IP:8080/swagger-ui.html | Swaggeræ–‡æ¡£ |

### DockeræœåŠ¡
| æœåŠ¡ | ç«¯å£ | è®¿é—®åœ°å€ | è®¤è¯ä¿¡æ¯ |
|------|------|----------|----------|
| PostgreSQL | 5432 | tcp://IP:5432 | drone/dronepassword |
| InfluxDB | 8086 | http://IP:8086 | admin/influxdb123 |
| EMQX Dashboard | 18083 | http://IP:18083 | admin/public |
| MQTT Broker | 1883 | tcp://IP:1883 | - |

## ğŸ“‹ æ—¥å¿—ç®¡ç†

### åº”ç”¨æ—¥å¿—
```bash
# åç«¯æ—¥å¿—
tail -f backend.log

# å‰ç«¯æ—¥å¿—
tail -f frontend.log
```

### Dockeræ—¥å¿—
```bash
# æ‰€æœ‰DockeræœåŠ¡æ—¥å¿—
docker-compose logs -f

# ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f postgres
docker-compose logs -f influxdb
docker-compose logs -f emqx
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### 1. å¯åŠ¨å¡åœ¨"æ›´æ–°ç½‘ç»œé…ç½®"
**åŸå› **ï¼šç½‘ç»œæ£€æµ‹è„šæœ¬æ‰§è¡Œæ—¶é—´è¿‡é•¿
**è§£å†³**ï¼šå·²æ·»åŠ 30ç§’è¶…æ—¶ä¿æŠ¤ï¼Œè‡ªåŠ¨fallbackåˆ°localhost

#### 2. DockeræœåŠ¡æœªå¯åŠ¨
**æ£€æŸ¥**ï¼š
```bash
docker info  # æ£€æŸ¥Dockeræ˜¯å¦è¿è¡Œ
docker-compose ps  # æ£€æŸ¥æœåŠ¡çŠ¶æ€
```
**è§£å†³**ï¼š
```bash
docker-compose up -d  # å¯åŠ¨æ‰€æœ‰æœåŠ¡
```

#### 3. ç«¯å£å†²çª
**æ£€æŸ¥**ï¼š
```bash
lsof -i :ç«¯å£å·  # æ£€æŸ¥ç«¯å£å ç”¨
```
**è§£å†³**ï¼š
```bash
./stop-system.sh --docker  # å®Œå…¨åœæ­¢å†é‡å¯
```

#### 4. æ•°æ®åº“è¿æ¥å¤±è´¥
**æ£€æŸ¥**ï¼š
```bash
./check-status.sh  # æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
```
**è§£å†³**ï¼š
```bash
docker-compose restart postgres  # é‡å¯æ•°æ®åº“
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ—¥å¸¸ä½¿ç”¨
```bash
# å¯åŠ¨ç³»ç»Ÿ
./start-system.sh

# æ£€æŸ¥çŠ¶æ€
./check-status.sh

# åœæ­¢ç³»ç»Ÿ
./stop-system.sh
```

### 2. ç½‘ç»œåˆ‡æ¢
```bash
# è‡ªåŠ¨æ›´æ–°ç½‘ç»œé…ç½®
./update-network-config.sh --auto
```

### 3. å¼€å‘è°ƒè¯•
```bash
# ä»…åœæ­¢åº”ç”¨æœåŠ¡ï¼ˆä¿ç•™DockeræœåŠ¡ï¼‰
./stop-system.sh --app-only

# é‡å¯åº”ç”¨æœåŠ¡
./restart-system.sh
```

### 4. å®Œå…¨é‡ç½®
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop-system.sh --docker

# é‡æ–°å¯åŠ¨
./start-system.sh
```

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ç«¯å£é…ç½®
å¦‚éœ€ä¿®æ”¹ç«¯å£ï¼Œè¯·æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š
- `docker-compose.yml` - DockeræœåŠ¡ç«¯å£
- `start-system.sh` - è„šæœ¬ä¸­çš„ç«¯å£å¸¸é‡
- `application-external.yml` - åç«¯é…ç½®

### ç½‘ç»œé…ç½®
ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç½‘ç»œå˜åŒ–ï¼Œä¹Ÿå¯æ‰‹åŠ¨é…ç½®ï¼š
- `.network-config` - ç½‘ç»œé…ç½®ç¼“å­˜
- `.env.production` - å‰ç«¯ç”Ÿäº§ç¯å¢ƒé…ç½®
- `.env.development` - å‰ç«¯å¼€å‘ç¯å¢ƒé…ç½®

## ğŸ‰ æ€»ç»“

å¢å¼ºç‰ˆå¯åŠ¨ç³»ç»Ÿæä¾›äº†ï¼š
- ğŸš€ **ä¸€é”®å¯åŠ¨**ï¼šå®Œæ•´çš„ç³»ç»Ÿè‡ªåŠ¨åŒ–å¯åŠ¨
- ğŸ³ **Dockeré›†æˆ**ï¼šè‡ªåŠ¨ç®¡ç†æ‰€æœ‰åŸºç¡€æœåŠ¡
- ğŸŒ **ç½‘ç»œè‡ªé€‚åº”**ï¼šæ™ºèƒ½æ£€æµ‹å’Œé…ç½®æ›´æ–°
- ğŸ“Š **å…¨é¢ç›‘æ§**ï¼šå®Œæ•´çš„çŠ¶æ€æ£€æŸ¥å’Œå¥åº·ç›‘æ§
- ğŸ›¡ï¸ **æ•…éšœä¿æŠ¤**ï¼šè¶…æ—¶ä¿æŠ¤å’Œé”™è¯¯å¤„ç†
- ğŸ”§ **çµæ´»ç®¡ç†**ï¼šå¤šç§å¯åœæ¨¡å¼å’Œå‚æ•°é€‰é¡¹

**äº«å—æ— ç¼çš„å¼€å‘å’Œéƒ¨ç½²ä½“éªŒï¼** ğŸ¯ 